<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Generated by Caltrop Parser version 1.2 -->
<Actor name="MCadd">
    <Import kind="package">
        <QID name="caltrop.lib.BitOps">
            <ID name="caltrop"/>
            <ID name="lib"/>
            <ID name="BitOps"/>
        </QID>
    </Import>
    <TypeParameter name="int"/>
    <Decl kind="Parameter" name="WINSIZE">
        <Type name="int"/>
    </Decl>
    <Decl kind="Parameter" name="MAXMBWIDTH">
        <Type name="int"/>
    </Decl>
    <Port kind="Input" name="LAST">
        <Type name="List">
            <Entry kind="Type">
                <Type name="int"/>
            </Entry>
        </Type>
    </Port>
    <Port kind="Input" name="TEX">
        <Type name="List">
            <Entry kind="Type">
                <Type name="int"/>
            </Entry>
        </Type>
    </Port>
    <Port kind="Input" name="MV">
        <Type name="int"/>
    </Port>
    <Port kind="Output" name="VID">
        <Type name="List">
            <Entry kind="Type">
                <Type name="int"/>
            </Entry>
        </Type>
    </Port>
    <Decl kind="Variable" name="MBwidth" assignable="Yes">
        <Type name="int"/>
        <Expr kind="Literal" literal-kind="Integer" value="0"/>
    </Decl>
    <Decl kind="Variable" name="MBheight" assignable="Yes">
        <Type name="int"/>
        <Expr kind="Literal" literal-kind="Integer" value="0"/>
    </Decl>
    <Decl kind="Variable" name="rounding_type" assignable="Yes">
        <Type name="int"/>
        <Expr kind="Literal" literal-kind="Integer" value="0"/>
    </Decl>
    <Decl kind="Variable" name="next_x" assignable="Yes">
        <Type name="int"/>
    </Decl>
    <Decl kind="Variable" name="next_y" assignable="Yes">
        <Type name="int"/>
    </Decl>
    <Decl kind="Variable" name="next_n" assignable="Yes">
        <Type name="int"/>
    </Decl>
    <Decl kind="Variable" name="int_buf_count" assignable="Yes">
        <Type name="int"/>
        <Expr kind="Literal" literal-kind="Integer" value="0"/>
    </Decl>
    <Decl kind="Variable" name="int_buf_count_ss" assignable="Yes">
        <Type name="int"/>
    </Decl>
    <Decl kind="Variable" name="ext_buf_count" assignable="Yes">
        <Type name="int"/>
        <Expr kind="Literal" literal-kind="Integer" value="0"/>
    </Decl>
    <Decl kind="Variable" name="ext_buf_count_ss" assignable="Yes">
        <Type name="int"/>
    </Decl>
    <Decl kind="Variable" name="frame_count" assignable="Yes">
        <Type name="int"/>
    </Decl>
    <Decl kind="Variable" name="frame_number" assignable="Yes">
        <Type name="int"/>
        <Expr kind="Literal" literal-kind="Integer" value="0"/>
    </Decl>
    <Decl kind="Variable" name="head_index" assignable="Yes">
        <Type name="int"/>
    </Decl>
    <Decl kind="Variable" name="initList">
        <Type kind="Function" infer="true" name="List"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="v"/>
            <Decl kind="Parameter" name="size"/>
            <Expr kind="List">
                <Expr kind="Var" name="v"/>
                <Generator>
                    <Decl kind="Generator" name="i"/>
                    <Expr kind="Application">
                        <Expr kind="Var" name="Integers"/>
                        <Args>
                            <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            <Expr kind="Var" name="size"/>
                        </Args>
                    </Expr>
                </Generator>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="MBbuf_size">
        <Type name="int"/>
        <Expr kind="BinOpSeq">
            <Expr kind="Literal" literal-kind="Integer" value="6"/>
            <Op name="*"/>
            <Expr kind="BinOpSeq">
                <Expr kind="BinOpSeq">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="WINSIZE"/>
                        <Op name="-"/>
                        <Expr kind="Literal" literal-kind="Integer" value="1"/>
                    </Expr>
                    <Op name="*"/>
                    <Expr kind="Var" name="MAXMBWIDTH"/>
                </Expr>
                <Op name="+"/>
                <Expr kind="Var" name="WINSIZE"/>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="MBbuf_ptr" assignable="Yes">
        <Type name="int"/>
        <Expr kind="Literal" literal-kind="Integer" value="0"/>
    </Decl>
    <Decl kind="Variable" name="MBbuf">
        <Type name="List">
            <Entry kind="Type">
                <Type name="List">
                    <Entry kind="Type">
                        <Type name="int"/>
                    </Entry>
                </Type>
            </Entry>
        </Type>
        <Expr kind="Application">
            <Expr kind="Var" name="initList"/>
            <Args>
                <Expr kind="Application">
                    <Expr kind="Var" name="initList"/>
                    <Args>
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                        <Expr kind="Literal" literal-kind="Integer" value="64"/>
                    </Args>
                </Expr>
                <Expr kind="Var" name="MBbuf_size"/>
            </Args>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="MBbuf_add">
        <Type kind="Procedure" infer="true"/>
        <Expr kind="Proc">
            <Decl kind="Parameter" name="b"/>
            <Stmt kind="Assign" name="MBbuf_ptr">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="MBbuf_ptr"/>
                    <Op name="+"/>
                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                </Expr>
            </Stmt>
            <Stmt kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="MBbuf_ptr"/>
                    <Op name="&gt;="/>
                    <Expr kind="Var" name="MBbuf_size"/>
                </Expr>
                <Stmt kind="Block">
                    <Stmt kind="Assign" name="MBbuf_ptr">
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                    </Stmt>
                </Stmt>
            </Stmt>
            <Stmt kind="Call">
                <Expr kind="Entry" name="set">
                    <Expr kind="Var" name="MBbuf"/>
                </Expr>
                <Args>
                    <Expr kind="Var" name="MBbuf_ptr"/>
                    <Expr kind="Var" name="b"/>
                </Args>
            </Stmt>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="MBbuf_get">
        <Type kind="Function" infer="true" name="List"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="offset"/>
            <Decl kind="Variable" name="ptr">
                <Type name="int"/>
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="MBbuf_ptr"/>
                    <Op name="-"/>
                    <Expr kind="Var" name="offset"/>
                </Expr>
            </Decl>
            <Decl kind="Variable" name="ptr_wrapped">
                <Type name="int"/>
                <Expr kind="If">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="ptr"/>
                        <Op name="&lt;"/>
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                    </Expr>
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="ptr"/>
                        <Op name="+"/>
                        <Expr kind="Var" name="MBbuf_size"/>
                    </Expr>
                    <Expr kind="If">
                        <Expr kind="BinOpSeq">
                            <Expr kind="Var" name="ptr"/>
                            <Op name="&gt;="/>
                            <Expr kind="Var" name="MBbuf_size"/>
                        </Expr>
                        <Expr kind="BinOpSeq">
                            <Expr kind="Var" name="ptr"/>
                            <Op name="-"/>
                            <Expr kind="Var" name="MBbuf_size"/>
                        </Expr>
                        <Expr kind="Var" name="ptr"/>
                    </Expr>
                </Expr>
            </Decl>
            <Expr kind="Application">
                <Expr kind="Entry" name="get">
                    <Expr kind="Var" name="MBbuf"/>
                </Expr>
                <Args>
                    <Expr kind="Var" name="ptr_wrapped"/>
                </Args>
            </Expr>
        </Expr>
    </Decl>
    <Action text-begin-line="67" text-begin-col="13" text-end-line="91" text-end-col="3">
        <QID name="newFrame">
            <ID name="newFrame"/>
        </QID>
        <Input kind="Elements" port="MV">
            <Decl kind="Input" name="cmd"/>
            <Decl kind="Input" name="x"/>
            <Decl kind="Input" name="y"/>
            <Decl kind="Input" name="rounding"/>
            <Decl kind="Input" name="unused1"/>
            <Decl kind="Input" name="unused2"/>
        </Input>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="cmd"/>
                <Op name="="/>
                <Expr kind="UnaryOp">
                    <Op name="-"/>
                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                </Expr>
            </Expr>
        </Guards>
        <Stmt kind="If">
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="x"/>
                <Op name="!="/>
                <Expr kind="Var" name="MBwidth"/>
                <Op name="or"/>
                <Expr kind="Var" name="y"/>
                <Op name="!="/>
                <Expr kind="Var" name="MBheight"/>
            </Expr>
            <Stmt kind="Block">
                <Stmt kind="Assign" name="int_buf_count_ss">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Literal" literal-kind="Integer" value="6"/>
                        <Op name="*"/>
                        <Expr kind="BinOpSeq">
                            <Expr kind="BinOpSeq">
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Var" name="WINSIZE"/>
                                    <Op name="-"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                                </Expr>
                                <Op name="*"/>
                                <Expr kind="Var" name="x"/>
                            </Expr>
                            <Op name="+"/>
                            <Expr kind="Var" name="WINSIZE"/>
                        </Expr>
                    </Expr>
                </Stmt>
                <Stmt kind="Assign" name="int_buf_count">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Literal" literal-kind="Integer" value="6"/>
                        <Op name="*"/>
                        <Expr kind="Application">
                            <Expr kind="Var" name="rshift"/>
                            <Args>
                                <Expr kind="BinOpSeq">
                                    <Expr kind="BinOpSeq">
                                        <Expr kind="BinOpSeq">
                                            <Expr kind="Var" name="WINSIZE"/>
                                            <Op name="-"/>
                                            <Expr kind="Literal" literal-kind="Integer" value="1"/>
                                        </Expr>
                                        <Op name="*"/>
                                        <Expr kind="Var" name="x"/>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Var" name="WINSIZE"/>
                                </Expr>
                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            </Args>
                        </Expr>
                    </Expr>
                </Stmt>
                <Stmt kind="Assign" name="frame_count">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="x"/>
                        <Op name="*"/>
                        <Expr kind="Var" name="y"/>
                        <Op name="*"/>
                        <Expr kind="Literal" literal-kind="Integer" value="6"/>
                    </Expr>
                </Stmt>
                <Stmt kind="Assign" name="head_index">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="int_buf_count"/>
                        <Op name="+"/>
                        <Expr kind="Literal" literal-kind="Integer" value="5"/>
                    </Expr>
                </Stmt>
                <Stmt kind="Assign" name="ext_buf_count_ss">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="frame_count"/>
                        <Op name="+"/>
                        <Expr kind="Var" name="int_buf_count"/>
                        <Op name="-"/>
                        <Expr kind="Var" name="int_buf_count_ss"/>
                    </Expr>
                </Stmt>
                <Stmt kind="Assign" name="MBwidth">
                    <Expr kind="Var" name="x"/>
                </Stmt>
                <Stmt kind="Assign" name="MBheight">
                    <Expr kind="Var" name="y"/>
                </Stmt>
            </Stmt>
        </Stmt>
        <Stmt kind="Assign" name="rounding_type">
            <Expr kind="Var" name="rounding"/>
        </Stmt>
        <Stmt kind="Assign" name="next_x">
            <Expr kind="Literal" literal-kind="Integer" value="0"/>
        </Stmt>
        <Stmt kind="Assign" name="next_y">
            <Expr kind="Literal" literal-kind="Integer" value="0"/>
        </Stmt>
        <Stmt kind="Assign" name="next_n">
            <Expr kind="Literal" literal-kind="Integer" value="0"/>
        </Stmt>
        <Stmt kind="Assign" name="frame_number">
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="frame_number"/>
                <Op name="+"/>
                <Expr kind="Literal" literal-kind="Integer" value="1"/>
            </Expr>
        </Stmt>
        <Stmt kind="If">
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="frame_number"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="190"/>
            </Expr>
            <Stmt kind="Block">
                <Stmt kind="Call">
                    <Expr kind="Var" name="println"/>
                    <Args>
                        <Expr kind="BinOpSeq">
                            <Expr kind="Literal" literal-kind="String" value="Frame "/>
                            <Op name="+"/>
                            <Expr kind="Var" name="frame_number"/>
                            <Op name="+"/>
                            <Expr kind="Literal" literal-kind="String" value=", rounding = "/>
                            <Op name="+"/>
                            <Expr kind="Var" name="rounding_type"/>
                        </Expr>
                    </Args>
                </Stmt>
            </Stmt>
        </Stmt>
    </Action>
    <Decl kind="Variable" name="detect_skipped">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="x"/>
            <Decl kind="Parameter" name="y"/>
            <Decl kind="Parameter" name="n"/>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="x"/>
                    <Op name="="/>
                    <Expr kind="Var" name="next_x"/>
                    <Op name="and"/>
                    <Expr kind="Var" name="y"/>
                    <Op name="="/>
                    <Expr kind="Var" name="next_y"/>
                    <Op name="and"/>
                    <Expr kind="Var" name="n"/>
                    <Op name="="/>
                    <Expr kind="Var" name="next_n"/>
                </Expr>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                <Expr kind="Literal" literal-kind="Integer" value="1"/>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="next_block">
        <Type kind="Procedure" infer="true"/>
        <Expr kind="Proc">
            <Stmt kind="Assign" name="next_n">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="next_n"/>
                    <Op name="+"/>
                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                </Expr>
            </Stmt>
            <Stmt kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="next_n"/>
                    <Op name="="/>
                    <Expr kind="Literal" literal-kind="Integer" value="6"/>
                </Expr>
                <Stmt kind="Block">
                    <Stmt kind="Assign" name="next_n">
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                    </Stmt>
                    <Stmt kind="Assign" name="next_x">
                        <Expr kind="BinOpSeq">
                            <Expr kind="Var" name="next_x"/>
                            <Op name="+"/>
                            <Expr kind="Literal" literal-kind="Integer" value="1"/>
                        </Expr>
                    </Stmt>
                    <Stmt kind="If">
                        <Expr kind="BinOpSeq">
                            <Expr kind="Var" name="next_x"/>
                            <Op name="="/>
                            <Expr kind="Var" name="MBwidth"/>
                        </Expr>
                        <Stmt kind="Block">
                            <Stmt kind="Assign" name="next_x">
                                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                            </Stmt>
                            <Stmt kind="Assign" name="next_y">
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Var" name="next_y"/>
                                    <Op name="+"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                                </Expr>
                            </Stmt>
                            <Stmt kind="If">
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Var" name="next_y"/>
                                    <Op name="="/>
                                    <Expr kind="Var" name="MBheight"/>
                                </Expr>
                                <Stmt kind="Block">
                                    <Stmt kind="Assign" name="next_y">
                                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                    </Stmt>
                                </Stmt>
                            </Stmt>
                        </Stmt>
                    </Stmt>
                </Stmt>
            </Stmt>
        </Expr>
    </Decl>
    <Action text-begin-line="114" text-begin-col="23" text-end-line="122" text-end-col="3">
        <QID name="docmd.missingBlock">
            <ID name="docmd"/>
            <ID name="missingBlock"/>
        </QID>
        <Input kind="Elements" port="MV">
            <Decl kind="Input" name="cmd"/>
            <Decl kind="Input" name="x"/>
            <Decl kind="Input" name="y"/>
            <Decl kind="Input" name="n"/>
            <Decl kind="Input" name="mvx"/>
            <Decl kind="Input" name="mvy"/>
        </Input>
        <Output port="VID">
            <Expr kind="Application">
                <Expr kind="Var" name="initList"/>
                <Args>
                    <Expr kind="If">
                        <Expr kind="BinOpSeq">
                            <Expr kind="Var" name="next_n"/>
                            <Op name="&lt;"/>
                            <Expr kind="Literal" literal-kind="Integer" value="4"/>
                        </Expr>
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                        <Expr kind="Literal" literal-kind="Integer" value="128"/>
                    </Expr>
                    <Expr kind="Literal" literal-kind="Integer" value="64"/>
                </Args>
            </Expr>
        </Output>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="cmd"/>
                <Op name="&gt;="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
            </Expr>
            <Expr kind="BinOpSeq">
                <Expr kind="Application">
                    <Expr kind="Var" name="detect_skipped"/>
                    <Args>
                        <Expr kind="Var" name="x"/>
                        <Expr kind="Var" name="y"/>
                        <Expr kind="Var" name="n"/>
                    </Args>
                </Expr>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="1"/>
            </Expr>
        </Guards>
        <Stmt kind="Call">
            <Expr kind="Var" name="println"/>
            <Args>
                <Expr kind="BinOpSeq">
                    <Expr kind="Literal" literal-kind="String" value="Missing block at ("/>
                    <Op name="+"/>
                    <Expr kind="Var" name="next_x"/>
                    <Op name="+"/>
                    <Expr kind="Literal" literal-kind="String" value=","/>
                    <Op name="+"/>
                    <Expr kind="Var" name="next_y"/>
                    <Op name="+"/>
                    <Expr kind="Literal" literal-kind="String" value=","/>
                    <Op name="+"/>
                    <Expr kind="Var" name="next_n"/>
                    <Op name="+"/>
                    <Expr kind="Literal" literal-kind="String" value=")"/>
                </Expr>
            </Args>
        </Stmt>
        <Stmt kind="Call">
            <Expr kind="Var" name="next_block"/>
            <Args/>
        </Stmt>
    </Action>
    <Action text-begin-line="129" text-begin-col="22" text-end-line="142" text-end-col="3">
        <QID name="docmd.textureOnly">
            <ID name="docmd"/>
            <ID name="textureOnly"/>
        </QID>
        <Input kind="Elements" port="MV">
            <Decl kind="Input" name="cmd"/>
            <Decl kind="Input" name="x"/>
            <Decl kind="Input" name="y"/>
            <Decl kind="Input" name="n"/>
            <Decl kind="Input" name="mvx"/>
            <Decl kind="Input" name="mvy"/>
        </Input>
        <Input kind="Elements" port="TEX">
            <Decl kind="Input" name="tex"/>
        </Input>
        <Output port="VID">
            <Expr kind="Var" name="tex"/>
        </Output>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="cmd"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="6"/>
            </Expr>
            <Expr kind="BinOpSeq">
                <Expr kind="Application">
                    <Expr kind="Var" name="detect_skipped"/>
                    <Args>
                        <Expr kind="Var" name="x"/>
                        <Expr kind="Var" name="y"/>
                        <Expr kind="Var" name="n"/>
                    </Args>
                </Expr>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
            </Expr>
        </Guards>
        <Stmt kind="If">
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="frame_number"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="190"/>
                <Op name="and"/>
                <Expr kind="Var" name="y"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                <Op name="and"/>
                <Expr kind="Var" name="x"/>
                <Op name="&lt;"/>
                <Expr kind="Literal" literal-kind="Integer" value="2"/>
                <Op name="and"/>
                <Expr kind="Var" name="n"/>
                <Op name="&lt;"/>
                <Expr kind="Literal" literal-kind="Integer" value="4"/>
            </Expr>
            <Stmt kind="Block">
                <Stmt kind="Call">
                    <Expr kind="Var" name="println"/>
                    <Args>
                        <Expr kind="BinOpSeq">
                            <Expr kind="Literal" literal-kind="String" value="TEX only at ("/>
                            <Op name="+"/>
                            <Expr kind="Var" name="next_x"/>
                            <Op name="+"/>
                            <Expr kind="Literal" literal-kind="String" value=","/>
                            <Op name="+"/>
                            <Expr kind="Var" name="next_y"/>
                            <Op name="+"/>
                            <Expr kind="Literal" literal-kind="String" value=","/>
                            <Op name="+"/>
                            <Expr kind="Var" name="next_n"/>
                            <Op name="+"/>
                            <Expr kind="Literal" literal-kind="String" value=")"/>
                        </Expr>
                    </Args>
                </Stmt>
            </Stmt>
        </Stmt>
        <Stmt kind="Call">
            <Expr kind="Var" name="next_block"/>
            <Args/>
        </Stmt>
    </Action>
    <Decl kind="Variable" name="xadjust">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="n"/>
            <Decl kind="Parameter" name="dx"/>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="n"/>
                    <Op name="&lt;"/>
                    <Expr kind="Literal" literal-kind="Integer" value="4"/>
                </Expr>
                <Expr kind="BinOpSeq">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Literal" literal-kind="Integer" value="6"/>
                        <Op name="*"/>
                        <Expr kind="Application">
                            <Expr kind="Var" name="rshift"/>
                            <Args>
                                <Expr kind="Var" name="dx"/>
                                <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            </Args>
                        </Expr>
                    </Expr>
                    <Op name="+"/>
                    <Expr kind="If">
                        <Expr kind="BinOpSeq">
                            <Expr kind="Application">
                                <Expr kind="Var" name="bitand"/>
                                <Args>
                                    <Expr kind="Var" name="dx"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="8"/>
                                </Args>
                            </Expr>
                            <Op name="="/>
                            <Expr kind="Literal" literal-kind="Integer" value="0"/>
                        </Expr>
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                        <Expr kind="If">
                            <Expr kind="BinOpSeq">
                                <Expr kind="Var" name="n"/>
                                <Op name="="/>
                                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                <Op name="or"/>
                                <Expr kind="Var" name="n"/>
                                <Op name="="/>
                                <Expr kind="Literal" literal-kind="Integer" value="2"/>
                            </Expr>
                            <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            <Expr kind="Literal" literal-kind="Integer" value="5"/>
                        </Expr>
                    </Expr>
                </Expr>
                <Expr kind="BinOpSeq">
                    <Expr kind="Literal" literal-kind="Integer" value="6"/>
                    <Op name="*"/>
                    <Expr kind="Application">
                        <Expr kind="Var" name="rshift"/>
                        <Args>
                            <Expr kind="Var" name="dx"/>
                            <Expr kind="Literal" literal-kind="Integer" value="3"/>
                        </Args>
                    </Expr>
                </Expr>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="yadjust">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="n"/>
            <Decl kind="Parameter" name="dy"/>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="n"/>
                    <Op name="&lt;"/>
                    <Expr kind="Literal" literal-kind="Integer" value="4"/>
                </Expr>
                <Expr kind="BinOpSeq">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Literal" literal-kind="Integer" value="6"/>
                        <Op name="*"/>
                        <Expr kind="Var" name="MBwidth"/>
                        <Op name="*"/>
                        <Expr kind="Application">
                            <Expr kind="Var" name="rshift"/>
                            <Args>
                                <Expr kind="Var" name="dy"/>
                                <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            </Args>
                        </Expr>
                    </Expr>
                    <Op name="+"/>
                    <Expr kind="If">
                        <Expr kind="BinOpSeq">
                            <Expr kind="Application">
                                <Expr kind="Var" name="bitand"/>
                                <Args>
                                    <Expr kind="Var" name="dy"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="8"/>
                                </Args>
                            </Expr>
                            <Op name="="/>
                            <Expr kind="Literal" literal-kind="Integer" value="0"/>
                        </Expr>
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                        <Expr kind="If">
                            <Expr kind="BinOpSeq">
                                <Expr kind="Var" name="n"/>
                                <Op name="="/>
                                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                <Op name="or"/>
                                <Expr kind="Var" name="n"/>
                                <Op name="="/>
                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            </Expr>
                            <Expr kind="Literal" literal-kind="Integer" value="2"/>
                            <Expr kind="BinOpSeq">
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Literal" literal-kind="Integer" value="6"/>
                                    <Op name="*"/>
                                    <Expr kind="Var" name="MBwidth"/>
                                </Expr>
                                <Op name="-"/>
                                <Expr kind="Literal" literal-kind="Integer" value="2"/>
                            </Expr>
                        </Expr>
                    </Expr>
                </Expr>
                <Expr kind="BinOpSeq">
                    <Expr kind="Literal" literal-kind="Integer" value="6"/>
                    <Op name="*"/>
                    <Expr kind="Var" name="MBwidth"/>
                    <Op name="*"/>
                    <Expr kind="Application">
                        <Expr kind="Var" name="rshift"/>
                        <Args>
                            <Expr kind="Var" name="dy"/>
                            <Expr kind="Literal" literal-kind="Integer" value="3"/>
                        </Args>
                    </Expr>
                </Expr>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="get_pixel">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="x"/>
            <Decl kind="Parameter" name="y"/>
            <Decl kind="Parameter" name="n"/>
            <Decl kind="Parameter" name="dx"/>
            <Decl kind="Parameter" name="dy"/>
            <Expr kind="Application">
                <Expr kind="Entry" name="get">
                    <Expr kind="Application">
                        <Expr kind="Var" name="MBbuf_get"/>
                        <Args>
                            <Expr kind="BinOpSeq">
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Var" name="head_index"/>
                                    <Op name="-"/>
                                    <Expr kind="Application">
                                        <Expr kind="Var" name="xadjust"/>
                                        <Args>
                                            <Expr kind="Var" name="n"/>
                                            <Expr kind="Var" name="dx"/>
                                        </Args>
                                    </Expr>
                                </Expr>
                                <Op name="-"/>
                                <Expr kind="Application">
                                    <Expr kind="Var" name="yadjust"/>
                                    <Args>
                                        <Expr kind="Var" name="n"/>
                                        <Expr kind="Var" name="dy"/>
                                    </Args>
                                </Expr>
                            </Expr>
                        </Args>
                    </Expr>
                </Expr>
                <Args>
                    <Expr kind="BinOpSeq">
                        <Expr kind="Application">
                            <Expr kind="Var" name="bitand"/>
                            <Args>
                                <Expr kind="Var" name="dx"/>
                                <Expr kind="Literal" literal-kind="Integer" value="7"/>
                            </Args>
                        </Expr>
                        <Op name="+"/>
                        <Expr kind="Application">
                            <Expr kind="Var" name="lshift"/>
                            <Args>
                                <Expr kind="Application">
                                    <Expr kind="Var" name="bitand"/>
                                    <Args>
                                        <Expr kind="Var" name="dy"/>
                                        <Expr kind="Literal" literal-kind="Integer" value="7"/>
                                    </Args>
                                </Expr>
                                <Expr kind="Literal" literal-kind="Integer" value="3"/>
                            </Args>
                        </Expr>
                    </Expr>
                </Args>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="xyclip">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="xy"/>
            <Decl kind="Parameter" name="xymax"/>
            <Decl kind="Parameter" name="dxy"/>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="xy"/>
                    <Op name="+"/>
                    <Expr kind="Var" name="dxy"/>
                    <Op name="&lt;"/>
                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                </Expr>
                <Expr kind="UnaryOp">
                    <Op name="-"/>
                    <Expr kind="Var" name="xy"/>
                </Expr>
                <Expr kind="If">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="xy"/>
                        <Op name="+"/>
                        <Expr kind="Var" name="dxy"/>
                        <Op name="&gt;="/>
                        <Expr kind="Var" name="xymax"/>
                    </Expr>
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="xymax"/>
                        <Op name="-"/>
                        <Expr kind="Var" name="xy"/>
                        <Op name="-"/>
                        <Expr kind="Literal" literal-kind="Integer" value="1"/>
                    </Expr>
                    <Expr kind="Var" name="dxy"/>
                </Expr>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="xpixel">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="x"/>
            <Decl kind="Parameter" name="n"/>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="n"/>
                    <Op name="="/>
                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                    <Op name="or"/>
                    <Expr kind="Var" name="n"/>
                    <Op name="="/>
                    <Expr kind="Literal" literal-kind="Integer" value="2"/>
                </Expr>
                <Expr kind="Application">
                    <Expr kind="Var" name="lshift"/>
                    <Args>
                        <Expr kind="Var" name="x"/>
                        <Expr kind="Literal" literal-kind="Integer" value="4"/>
                    </Args>
                </Expr>
                <Expr kind="If">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="n"/>
                        <Op name="="/>
                        <Expr kind="Literal" literal-kind="Integer" value="1"/>
                        <Op name="or"/>
                        <Expr kind="Var" name="n"/>
                        <Op name="="/>
                        <Expr kind="Literal" literal-kind="Integer" value="3"/>
                    </Expr>
                    <Expr kind="BinOpSeq">
                        <Expr kind="Application">
                            <Expr kind="Var" name="lshift"/>
                            <Args>
                                <Expr kind="Var" name="x"/>
                                <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            </Args>
                        </Expr>
                        <Op name="+"/>
                        <Expr kind="Literal" literal-kind="Integer" value="8"/>
                    </Expr>
                    <Expr kind="Application">
                        <Expr kind="Var" name="lshift"/>
                        <Args>
                            <Expr kind="Var" name="x"/>
                            <Expr kind="Literal" literal-kind="Integer" value="3"/>
                        </Args>
                    </Expr>
                </Expr>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="ypixel">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="y"/>
            <Decl kind="Parameter" name="n"/>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="n"/>
                    <Op name="="/>
                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                    <Op name="or"/>
                    <Expr kind="Var" name="n"/>
                    <Op name="="/>
                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                </Expr>
                <Expr kind="Application">
                    <Expr kind="Var" name="lshift"/>
                    <Args>
                        <Expr kind="Var" name="y"/>
                        <Expr kind="Literal" literal-kind="Integer" value="4"/>
                    </Args>
                </Expr>
                <Expr kind="If">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="n"/>
                        <Op name="="/>
                        <Expr kind="Literal" literal-kind="Integer" value="2"/>
                        <Op name="or"/>
                        <Expr kind="Var" name="n"/>
                        <Op name="="/>
                        <Expr kind="Literal" literal-kind="Integer" value="3"/>
                    </Expr>
                    <Expr kind="BinOpSeq">
                        <Expr kind="Application">
                            <Expr kind="Var" name="lshift"/>
                            <Args>
                                <Expr kind="Var" name="y"/>
                                <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            </Args>
                        </Expr>
                        <Op name="+"/>
                        <Expr kind="Literal" literal-kind="Integer" value="8"/>
                    </Expr>
                    <Expr kind="Application">
                        <Expr kind="Var" name="lshift"/>
                        <Args>
                            <Expr kind="Var" name="y"/>
                            <Expr kind="Literal" literal-kind="Integer" value="3"/>
                        </Args>
                    </Expr>
                </Expr>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="comp_block">
        <Type kind="Function" infer="true" name="List"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="x"/>
            <Decl kind="Parameter" name="y"/>
            <Decl kind="Parameter" name="n"/>
            <Decl kind="Parameter" name="mvx"/>
            <Decl kind="Parameter" name="mvy"/>
            <Decl kind="Variable" name="lmvx">
                <Type name="int"/>
                <Expr kind="Application">
                    <Expr kind="Var" name="rshift"/>
                    <Args>
                        <Expr kind="Var" name="mvx"/>
                        <Expr kind="Literal" literal-kind="Integer" value="1"/>
                    </Args>
                </Expr>
            </Decl>
            <Decl kind="Variable" name="lmvy">
                <Type name="int"/>
                <Expr kind="Application">
                    <Expr kind="Var" name="rshift"/>
                    <Args>
                        <Expr kind="Var" name="mvy"/>
                        <Expr kind="Literal" literal-kind="Integer" value="1"/>
                    </Args>
                </Expr>
            </Decl>
            <Decl kind="Variable" name="maxx">
                <Type name="int"/>
                <Expr kind="Application">
                    <Expr kind="Var" name="lshift"/>
                    <Args>
                        <Expr kind="Var" name="MBwidth"/>
                        <Expr kind="If">
                            <Expr kind="BinOpSeq">
                                <Expr kind="Var" name="n"/>
                                <Op name="&lt;"/>
                                <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            </Expr>
                            <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            <Expr kind="Literal" literal-kind="Integer" value="3"/>
                        </Expr>
                    </Args>
                </Expr>
            </Decl>
            <Decl kind="Variable" name="maxy">
                <Type name="int"/>
                <Expr kind="Application">
                    <Expr kind="Var" name="lshift"/>
                    <Args>
                        <Expr kind="Var" name="MBheight"/>
                        <Expr kind="If">
                            <Expr kind="BinOpSeq">
                                <Expr kind="Var" name="n"/>
                                <Op name="&lt;"/>
                                <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            </Expr>
                            <Expr kind="Literal" literal-kind="Integer" value="4"/>
                            <Expr kind="Literal" literal-kind="Integer" value="3"/>
                        </Expr>
                    </Args>
                </Expr>
            </Decl>
            <Decl kind="Variable" name="ulx">
                <Type name="int"/>
                <Expr kind="Application">
                    <Expr kind="Var" name="xpixel"/>
                    <Args>
                        <Expr kind="Var" name="x"/>
                        <Expr kind="Var" name="n"/>
                    </Args>
                </Expr>
            </Decl>
            <Decl kind="Variable" name="uly">
                <Type name="int"/>
                <Expr kind="Application">
                    <Expr kind="Var" name="ypixel"/>
                    <Args>
                        <Expr kind="Var" name="y"/>
                        <Expr kind="Var" name="n"/>
                    </Args>
                </Expr>
            </Decl>
            <Decl kind="Variable" name="b">
                <Type name="List">
                    <Entry kind="Type">
                        <Type name="int"/>
                    </Entry>
                </Type>
                <Expr kind="List">
                    <Expr kind="Application">
                        <Expr kind="Var" name="get_pixel"/>
                        <Args>
                            <Expr kind="Var" name="x"/>
                            <Expr kind="Var" name="y"/>
                            <Expr kind="Var" name="n"/>
                            <Expr kind="Application">
                                <Expr kind="Var" name="xyclip"/>
                                <Args>
                                    <Expr kind="Var" name="ulx"/>
                                    <Expr kind="Var" name="maxx"/>
                                    <Expr kind="BinOpSeq">
                                        <Expr kind="Var" name="xx"/>
                                        <Op name="+"/>
                                        <Expr kind="Var" name="lmvx"/>
                                    </Expr>
                                </Args>
                            </Expr>
                            <Expr kind="Application">
                                <Expr kind="Var" name="xyclip"/>
                                <Args>
                                    <Expr kind="Var" name="uly"/>
                                    <Expr kind="Var" name="maxy"/>
                                    <Expr kind="BinOpSeq">
                                        <Expr kind="Var" name="yy"/>
                                        <Op name="+"/>
                                        <Expr kind="Var" name="lmvy"/>
                                    </Expr>
                                </Args>
                            </Expr>
                        </Args>
                    </Expr>
                    <Generator>
                        <Decl kind="Generator" name="yy"/>
                        <Decl kind="Generator" name="xx"/>
                        <Expr kind="Application">
                            <Expr kind="Var" name="Integers"/>
                            <Args>
                                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                <Expr kind="Literal" literal-kind="Integer" value="8"/>
                            </Args>
                        </Expr>
                    </Generator>
                </Expr>
            </Decl>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Application">
                        <Expr kind="Var" name="bitand"/>
                        <Args>
                            <Expr kind="Var" name="mvx"/>
                            <Expr kind="Literal" literal-kind="Integer" value="1"/>
                        </Args>
                    </Expr>
                    <Op name="="/>
                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                </Expr>
                <Expr kind="If">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Application">
                            <Expr kind="Var" name="bitand"/>
                            <Args>
                                <Expr kind="Var" name="mvy"/>
                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            </Args>
                        </Expr>
                        <Op name="="/>
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                    </Expr>
                    <Expr kind="List">
                        <Expr kind="Application">
                            <Expr kind="Entry" name="get">
                                <Expr kind="Var" name="b"/>
                            </Expr>
                            <Args>
                                <Expr kind="BinOpSeq">
                                    <Expr kind="BinOpSeq">
                                        <Expr kind="Var" name="yy"/>
                                        <Op name="*"/>
                                        <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Var" name="xx"/>
                                </Expr>
                            </Args>
                        </Expr>
                        <Generator>
                            <Decl kind="Generator" name="yy"/>
                            <Decl kind="Generator" name="xx"/>
                            <Expr kind="Application">
                                <Expr kind="Var" name="Integers"/>
                                <Args>
                                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="7"/>
                                </Args>
                            </Expr>
                        </Generator>
                    </Expr>
                    <Expr kind="List">
                        <Expr kind="Application">
                            <Expr kind="Var" name="rshift"/>
                            <Args>
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                                <Op name="+"/>
                                                <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                                    <Op name="-"/>
                                    <Expr kind="Var" name="rounding_type"/>
                                </Expr>
                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            </Args>
                        </Expr>
                        <Generator>
                            <Decl kind="Generator" name="yy"/>
                            <Decl kind="Generator" name="xx"/>
                            <Expr kind="Application">
                                <Expr kind="Var" name="Integers"/>
                                <Args>
                                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="7"/>
                                </Args>
                            </Expr>
                        </Generator>
                    </Expr>
                </Expr>
                <Expr kind="If">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Application">
                            <Expr kind="Var" name="bitand"/>
                            <Args>
                                <Expr kind="Var" name="mvy"/>
                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            </Args>
                        </Expr>
                        <Op name="="/>
                        <Expr kind="Literal" literal-kind="Integer" value="0"/>
                    </Expr>
                    <Expr kind="List">
                        <Expr kind="Application">
                            <Expr kind="Var" name="rshift"/>
                            <Args>
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                                <Op name="+"/>
                                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="1"/>
                                    <Op name="-"/>
                                    <Expr kind="Var" name="rounding_type"/>
                                </Expr>
                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                            </Args>
                        </Expr>
                        <Generator>
                            <Decl kind="Generator" name="yy"/>
                            <Decl kind="Generator" name="xx"/>
                            <Expr kind="Application">
                                <Expr kind="Var" name="Integers"/>
                                <Args>
                                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="7"/>
                                </Args>
                            </Expr>
                        </Generator>
                    </Expr>
                    <Expr kind="List">
                        <Expr kind="Application">
                            <Expr kind="Var" name="rshift"/>
                            <Args>
                                <Expr kind="BinOpSeq">
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                                <Op name="+"/>
                                                <Expr kind="Literal" literal-kind="Integer" value="1"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                                <Op name="+"/>
                                                <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Application">
                                        <Expr kind="Entry" name="get">
                                            <Expr kind="Var" name="b"/>
                                        </Expr>
                                        <Args>
                                            <Expr kind="BinOpSeq">
                                                <Expr kind="BinOpSeq">
                                                    <Expr kind="Var" name="yy"/>
                                                    <Op name="*"/>
                                                    <Expr kind="Literal" literal-kind="Integer" value="9"/>
                                                </Expr>
                                                <Op name="+"/>
                                                <Expr kind="Var" name="xx"/>
                                                <Op name="+"/>
                                                <Expr kind="Literal" literal-kind="Integer" value="10"/>
                                            </Expr>
                                        </Args>
                                    </Expr>
                                    <Op name="+"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="2"/>
                                    <Op name="-"/>
                                    <Expr kind="Var" name="rounding_type"/>
                                </Expr>
                                <Expr kind="Literal" literal-kind="Integer" value="2"/>
                            </Args>
                        </Expr>
                        <Generator>
                            <Decl kind="Generator" name="yy"/>
                            <Decl kind="Generator" name="xx"/>
                            <Expr kind="Application">
                                <Expr kind="Var" name="Integers"/>
                                <Args>
                                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                                    <Expr kind="Literal" literal-kind="Integer" value="7"/>
                                </Args>
                            </Expr>
                        </Generator>
                    </Expr>
                </Expr>
            </Expr>
        </Expr>
    </Decl>
    <Action text-begin-line="263" text-begin-col="18" text-end-line="272" text-end-col="3">
        <QID name="docmd.nothing">
            <ID name="docmd"/>
            <ID name="nothing"/>
        </QID>
        <Input kind="Elements" port="MV">
            <Decl kind="Input" name="cmd"/>
            <Decl kind="Input" name="x"/>
            <Decl kind="Input" name="y"/>
            <Decl kind="Input" name="n"/>
            <Decl kind="Input" name="mvx"/>
            <Decl kind="Input" name="mvy"/>
        </Input>
        <Output port="VID">
            <Expr kind="Application">
                <Expr kind="Var" name="MBbuf_get"/>
                <Args>
                    <Expr kind="Var" name="head_index"/>
                </Args>
            </Expr>
        </Output>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="cmd"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
            </Expr>
            <Expr kind="BinOpSeq">
                <Expr kind="Application">
                    <Expr kind="Var" name="detect_skipped"/>
                    <Args>
                        <Expr kind="Var" name="x"/>
                        <Expr kind="Var" name="y"/>
                        <Expr kind="Var" name="n"/>
                    </Args>
                </Expr>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
            </Expr>
        </Guards>
        <Stmt kind="Call">
            <Expr kind="Var" name="next_block"/>
            <Args/>
        </Stmt>
    </Action>
    <Action text-begin-line="274" text-begin-col="21" text-end-line="285" text-end-col="3">
        <QID name="docmd.motionOnly">
            <ID name="docmd"/>
            <ID name="motionOnly"/>
        </QID>
        <Input kind="Elements" port="MV">
            <Decl kind="Input" name="cmd"/>
            <Decl kind="Input" name="x"/>
            <Decl kind="Input" name="y"/>
            <Decl kind="Input" name="n"/>
            <Decl kind="Input" name="mvx"/>
            <Decl kind="Input" name="mvy"/>
        </Input>
        <Output port="VID">
            <Expr kind="Var" name="b"/>
        </Output>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="cmd"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                <Op name="or"/>
                <Expr kind="Var" name="cmd"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="1"/>
            </Expr>
            <Expr kind="BinOpSeq">
                <Expr kind="Application">
                    <Expr kind="Var" name="detect_skipped"/>
                    <Args>
                        <Expr kind="Var" name="x"/>
                        <Expr kind="Var" name="y"/>
                        <Expr kind="Var" name="n"/>
                    </Args>
                </Expr>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
            </Expr>
        </Guards>
        <Decl kind="Variable" name="b">
            <Type name="List">
                <Entry kind="Type">
                    <Type name="int"/>
                </Entry>
            </Type>
            <Expr kind="Application">
                <Expr kind="Var" name="comp_block"/>
                <Args>
                    <Expr kind="Var" name="x"/>
                    <Expr kind="Var" name="y"/>
                    <Expr kind="Var" name="n"/>
                    <Expr kind="Var" name="mvx"/>
                    <Expr kind="Var" name="mvy"/>
                </Args>
            </Expr>
        </Decl>
        <Stmt kind="Call">
            <Expr kind="Var" name="next_block"/>
            <Args/>
        </Stmt>
    </Action>
    <Decl kind="Variable" name="clip">
        <Type kind="Function" infer="true"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="x"/>
            <Expr kind="If">
                <Expr kind="BinOpSeq">
                    <Expr kind="Var" name="x"/>
                    <Op name="&lt;"/>
                    <Expr kind="Literal" literal-kind="Integer" value="0"/>
                </Expr>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
                <Expr kind="If">
                    <Expr kind="BinOpSeq">
                        <Expr kind="Var" name="x"/>
                        <Op name="&gt;"/>
                        <Expr kind="Literal" literal-kind="Integer" value="255"/>
                    </Expr>
                    <Expr kind="Literal" literal-kind="Integer" value="255"/>
                    <Expr kind="Var" name="x"/>
                </Expr>
            </Expr>
        </Expr>
    </Decl>
    <Decl kind="Variable" name="combine">
        <Type kind="Function" infer="true" name="List"/>
        <Expr kind="Lambda">
            <Decl kind="Parameter" name="a">
		<Type name="List"/>
	    </Decl>
            <Decl kind="Parameter" name="b">
		<Type name="List"/>
            </Decl>
            <Expr kind="List">
                <Expr kind="Application">
                    <Expr kind="Var" name="clip"/>
                    <Args>
                        <Expr kind="BinOpSeq">
                            <Expr kind="Application">
                                <Expr kind="Entry" name="get">
                                    <Expr kind="Var" name="a"/>
                                </Expr>
                                <Args>
                                    <Expr kind="Var" name="i"/>
                                </Args>
                            </Expr>
                            <Op name="+"/>
                            <Expr kind="Application">
                                <Expr kind="Entry" name="get">
                                    <Expr kind="Var" name="b"/>
                                </Expr>
                                <Args>
                                    <Expr kind="Var" name="i"/>
                                </Args>
                            </Expr>
                        </Expr>
                    </Args>
                </Expr>
                <Generator>
                    <Decl kind="Generator" name="i"/>
                    <Expr kind="Application">
                        <Expr kind="Var" name="Integers"/>
                        <Args>
                            <Expr kind="Literal" literal-kind="Integer" value="0"/>
                            <Expr kind="Literal" literal-kind="Integer" value="63"/>
                        </Args>
                    </Expr>
                </Generator>
            </Expr>
        </Expr>
    </Decl>
    <Action text-begin-line="297" text-begin-col="15" text-end-line="309" text-end-col="3">
        <QID name="docmd.both">
            <ID name="docmd"/>
            <ID name="both"/>
        </QID>
        <Input kind="Elements" port="MV">
            <Decl kind="Input" name="cmd"/>
            <Decl kind="Input" name="x"/>
            <Decl kind="Input" name="y"/>
            <Decl kind="Input" name="n"/>
            <Decl kind="Input" name="mvx"/>
            <Decl kind="Input" name="mvy"/>
        </Input>
        <Input kind="Elements" port="TEX">
            <Decl kind="Input" name="tex"/>
        </Input>
        <Output port="VID">
            <Expr kind="Application">
                <Expr kind="Var" name="combine"/>
                <Args>
                    <Expr kind="Var" name="tex"/>
                    <Expr kind="Var" name="b"/>
                </Args>
            </Expr>
        </Output>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="cmd"/>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="4"/>
            </Expr>
            <Expr kind="BinOpSeq">
                <Expr kind="Application">
                    <Expr kind="Var" name="detect_skipped"/>
                    <Args>
                        <Expr kind="Var" name="x"/>
                        <Expr kind="Var" name="y"/>
                        <Expr kind="Var" name="n"/>
                    </Args>
                </Expr>
                <Op name="="/>
                <Expr kind="Literal" literal-kind="Integer" value="0"/>
            </Expr>
        </Guards>
        <Decl kind="Variable" name="b">
            <Type name="List">
                <Entry kind="Type">
                    <Type name="int"/>
                </Entry>
            </Type>
            <Expr kind="Application">
                <Expr kind="Var" name="comp_block"/>
                <Args>
                    <Expr kind="Var" name="x"/>
                    <Expr kind="Var" name="y"/>
                    <Expr kind="Var" name="n"/>
                    <Expr kind="Var" name="mvx"/>
                    <Expr kind="Var" name="mvy"/>
                </Args>
            </Expr>
        </Decl>
        <Stmt kind="Call">
            <Expr kind="Var" name="next_block"/>
            <Args/>
        </Stmt>
    </Action>
    <Action text-begin-line="312" text-begin-col="22" text-end-line="319" text-end-col="3">
        <QID name="mbbuf.tooEmptyInt">
            <ID name="mbbuf"/>
            <ID name="tooEmptyInt"/>
        </QID>
        <Input kind="Elements" port="LAST">
            <Decl kind="Input" name="b"/>
        </Input>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="int_buf_count"/>
                <Op name="&lt;"/>
                <Expr kind="Var" name="int_buf_count_ss"/>
            </Expr>
        </Guards>
        <Stmt kind="Call">
            <Expr kind="Var" name="MBbuf_add"/>
            <Args>
                <Expr kind="Var" name="b"/>
            </Args>
        </Stmt>
        <Stmt kind="Assign" name="int_buf_count">
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="int_buf_count"/>
                <Op name="+"/>
                <Expr kind="Literal" literal-kind="Integer" value="1"/>
            </Expr>
        </Stmt>
    </Action>
    <Action text-begin-line="321" text-begin-col="22" text-end-line="327" text-end-col="3">
        <QID name="mbbuf.tooEmptyExt">
            <ID name="mbbuf"/>
            <ID name="tooEmptyExt"/>
        </QID>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="int_buf_count"/>
                <Op name="="/>
                <Expr kind="Var" name="int_buf_count_ss"/>
            </Expr>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="ext_buf_count"/>
                <Op name="&lt;"/>
                <Expr kind="Var" name="ext_buf_count_ss"/>
            </Expr>
        </Guards>
        <Stmt kind="Assign" name="ext_buf_count">
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="ext_buf_count"/>
                <Op name="+"/>
                <Expr kind="Literal" literal-kind="Integer" value="1"/>
            </Expr>
        </Stmt>
    </Action>
    <Action text-begin-line="329" text-begin-col="18" text-end-line="334" text-end-col="3">
        <QID name="mbbuf.tooFull">
            <ID name="mbbuf"/>
            <ID name="tooFull"/>
        </QID>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="int_buf_count"/>
                <Op name="&gt;"/>
                <Expr kind="Var" name="int_buf_count_ss"/>
                <Op name="or"/>
                <Expr kind="Var" name="ext_buf_count"/>
                <Op name="&gt;"/>
                <Expr kind="Var" name="ext_buf_count_ss"/>
            </Expr>
        </Guards>
        <Stmt kind="Call">
            <Expr kind="Var" name="println"/>
            <Args>
                <Expr kind="Literal" literal-kind="String" value="Unsupported action: mbbuf.tooFull in actor MCadd"/>
            </Args>
        </Stmt>
    </Action>
    <Action text-begin-line="337" text-begin-col="20" text-end-line="344" text-end-col="3">
        <QID name="mbbuf.justRight">
            <ID name="mbbuf"/>
            <ID name="justRight"/>
        </QID>
        <Input kind="Elements" port="LAST">
            <Decl kind="Input" name="b"/>
        </Input>
        <Guards>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="int_buf_count"/>
                <Op name="="/>
                <Expr kind="Var" name="int_buf_count_ss"/>
            </Expr>
            <Expr kind="BinOpSeq">
                <Expr kind="Var" name="ext_buf_count"/>
                <Op name="="/>
                <Expr kind="Var" name="ext_buf_count_ss"/>
            </Expr>
        </Guards>
        <Stmt kind="Call">
            <Expr kind="Var" name="MBbuf_add"/>
            <Args>
                <Expr kind="Var" name="b"/>
            </Args>
        </Stmt>
    </Action>
    <Schedule kind="fsm" initial-state="process">
        <Transition from="process" to="process">
            <ActionTags>
                <QID name="newFrame">
                    <ID name="newFrame"/>
                </QID>
            </ActionTags>
        </Transition>
        <Transition from="process" to="update">
            <ActionTags>
                <QID name="docmd">
                    <ID name="docmd"/>
                </QID>
            </ActionTags>
        </Transition>
        <Transition from="update" to="process">
            <ActionTags>
                <QID name="mbbuf">
                    <ID name="mbbuf"/>
                </QID>
            </ActionTags>
        </Transition>
    </Schedule>
</Actor>
